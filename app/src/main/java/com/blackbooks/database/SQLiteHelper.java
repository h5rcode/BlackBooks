package com.blackbooks.database;

import android.content.Context;
import android.database.sqlite.SQLiteDatabase;
import android.database.sqlite.SQLiteOpenHelper;
import android.util.Log;

import com.blackbooks.database.upgrades.Version2;
import com.blackbooks.database.upgrades.Version3;
import com.blackbooks.services.IsbnServices;
import com.blackbooks.sql.Broker;
import com.blackbooks.sql.BrokerManager;
import com.blackbooks.sql.FTSBroker;
import com.blackbooks.sql.FTSBrokerManager;
import com.blackbooks.utils.LogUtils;

import java.util.List;

/**
 * Helper class to create/open/upgrade the database.
 */
public final class SQLiteHelper extends SQLiteOpenHelper {

    private static SQLiteHelper mInstance;

    /**
     * Private constructor.
     *
     * @param context Context.
     */
    private SQLiteHelper(Context context) {
        super(context, Database.NAME, null, Database.VERSION);
    }

    /**
     * Initialize the singleton.
     *
     * @param context Context.
     */
    public static synchronized void initialize(Context context) {
        mInstance = new SQLiteHelper(context);
    }

    /**
     * Return the instance.
     *
     * @return SQLiteHelper.
     */
    public static SQLiteHelper getInstance() {
        return mInstance;
    }

    @Override
    public void onCreate(SQLiteDatabase db) {
        Log.i(LogUtils.TAG, "Creating the database.");

        Database database = Database.getInstance();
        List<Class<?>> tables = database.getTables();

        Log.i(LogUtils.TAG, "Creating tables.");
        for (Class<?> table : tables) {
            Broker<?> broker = BrokerManager.getBroker(table);
            broker.createTable(db);
        }
        Log.i(LogUtils.TAG, "Tables successfully created.");

        List<Class<?>> ftsTables = database.getFTSTables();

        Log.i(LogUtils.TAG, "Creating the Full-Text-Search tables.");
        for (Class<?> ftsTable : ftsTables) {
            FTSBroker<?> ftsBroker = FTSBrokerManager.getBroker(ftsTable);
            ftsBroker.createTable(db);
        }
        Log.i(LogUtils.TAG, "Full-Text-Search tables successfully created.");

        Log.i(LogUtils.TAG, "Database successfully created.");

        String[] isbns = new String[]{
                "9781502351401",
                "9782253109587",
                "9782081270640",
                "9780140366754",
                "9788497592208",
                "9780141199054",
                "9780061703089",
                "9782742728213",
                "9782070408993",
                "9782253046202",
                "9782868697998",
                "9782266070256",
                "9782266054713",
                "9782818501788",
                "9782070360017",
                "9782080705303",
                "9782911188480",
                "9782264011039",
                "9782228882545",
                "9782266097949",
                "9782290319055",
                "9782264028051",
                "0026515628",
                "0030020786",
                "0030350840",
                "0070109109",
                "0070311366",
                "0070350485",
                "007035958X",
                "0070393605",
                "0070418780",
                "007054235X",
                "0072294337",
                "0072299908",
                "007231592X",
                "0072321113",
                "0072339705",
                "0072345535",
                "0072348984",
                "0072350539",
                "0072380322",
                "0072385790",
                "0072392665",
                "0072398876",
                "0072402318",
                "0072406550",
                "0072431881",
                "0072432020",
                "0072437316",
                "0072448482",
                "0072452692",
                "0072460539",
                "007246352X",
                "007246464X",
                "0072465239",
                "0072465638",
                "0072466855",
                "0072467509",
                "0072468246",
                "007246836X",
                "0072471468",
                "0072478527",
                "0072492953",
                "0072499389",
                "0072505036",
                "0072525231",
                "0072528303",
                "0072534958",
                "0072819359",
                "0072823402",
                "0072827416",
                "0072828803",
                "0072829206",
                "0072830085",
                "0072830875",
                "0072831561",
                "0072834943",
                "0072838787",
                "0072846119",
                "0072848235",
                "0072859342",
                "0072861789",
                "0072864478",
                "0072864877",
                "0072865784",
                "0072865989",
                "0072871776",
                "0072872527",
                "0072873795",
                "0072875062",
                "0072876484",
                "0072881208",
                "0072887605",
                "0072918993",
                "0072919817",
                "0072921641",
                "0072921935",
                "0072922184",
                "0072922427",
                "007293414X",
                "007293588X",
                "0072936932",
                "0072947756",
                "0072947888",
                "0072951753",
                "0072957239",
                "0072958863",
                "0072961449",
                "007296183X",
                "0072961902",
                "0072961945",
                "007296216X",
                "0072962216",
                "0072963050",
                "0072964200",
                "0072964464",
                "0072964723",
                "0072965975",
                "0072966343",
                "0072966556",
                "0072967722",
                "0072971215",
                "0072971223",
                "0072971231",
                "0072975865",
                "0072976756",
                "0072976861",
                "0072977353",
                "0072977450",
                "0072977515",
                "0072977558",
                "0072978635",
                "0072979526",
                "0072980907",
                "0072982713",
                "0072983019",
                "0072983809",
                "0072983906",
                "0072986212",
                "0072986220",
                "0072987170",
                "0072987227",
                "0072987286",
                "0072987324",
                "007298936X",
                "0072990716",
                "0072991054",
                "0072992565",
                "0072994029",
                "0072994355",
                "0072994428",
                "0072995688",
                "0072996862",
                "0073011215",
                "0073012386",
                "0073016039",
                "0073018376",
                "0073018651",
                "007301933X",
                "0073040762",
                "0073044652",
                "0073046671",
                "0073048380",
                "0073049204",
                "0073049212",
                "0073050199",
                "0073051888",
                "0073051896",
                "0073052337",
                "0073080152",
                "0073100234",
                "0073101567",
                "0073101591",
                "0073101699",
                "0073101702",
                "0073101710",
                "0073101745",
                "0073101761",
                "0073102555",
                "0073104027",
                "0073104450",
                "0073104639",
                "0073104647",
                "0073105767",
                "0073107638",
                "0073107670",
                "0073107689",
                "0073107956",
                "007310874X",
                "007310938X",
                "007310941X",
                "0073109444",
                "0073109630",
                "0073121657",
                "0073121665",
                "0073122580",
                "0073122866",
                "0073126993",
                "0073128929",
                "0073130826",
                "0073131946",
                "0073134287",
                "0073134295",
                "0073134937",
                "0073135690",
                "0073135852",
                "0073135941",
                "0073136905",
                "0073137537",
                "0073138339",
                "0073138967",
                "0073191752",
                "0073191817",
                "0073191833",
                "0073192635",
                "0073194174",
                "0073203130",
                "0073205346",
                "0073211141",
                "0073214876",
                "0073215775",
                "0073219460",
                "0073220337",
                "0073221074",
                "0073224359",
                "0073229784",
                "0073250325",
                "0073256439",
                "0073660094",
                "0073660558",
                "0125980558",
                "0125980574",
                "0130082058",
                "0130083690",
                "0130084611",
                "0130085073",
                "0130085197",
                "0130088471",
                "0130167630",
                "0130175986",
                "0130281271",
                "0130307912",
                "0130313580",
                "0130332712",
                "013034074X",
                "0130342815",
                "0130352802",
                "0130354716",
                "0130384712",
                "0130404675",
                "0130408719",
                "0130411507",
                "013041977X",
                "0130460192",
                "0130461067",
                "0130466417",
                "0130471100",
                "0130473944",
                "0130489875",
                "0130606200",
                "0130608998",
                "0130609072",
                "0130618853",
                "0130652458",
                "0130661899",
                "013066491X",
                "013081542X",
                "0130819085",
                "0130868175",
                "0130882399",
                "0130889784",
                "0130909963",
                "0130925535",
                "0130930857",
                "0131013653",
                "013101367X",
                "0131073893",
                "0131095978",
                "0131096869",
                "0131108956",
                "0131112023",
                "0131118927",
                "0131131273",
                "0131137646",
                "0131146246",
                "0131148656",
                "0131150863",
                "0131176862",
                "0131181114",
                "0131190768",
                "0131190873",
                "0131216333",
                "0131402080",
                "0131404121",
                "0131409417",
                "0131409700",
                "0131424629",
                "0131424718",
                "0131427067",
                "0131430211",
                "0131432613",
                "0131432753",
                "0131433512",
                "0131433725",
                "0131435825",
                "0131437453",
                "0131439944",
                "0131440977",
                "0131442007",
                "0131442341",
                "0131443291",
                "0131444476",
                "0131445650",
                "0131445715",
                "0131446797",
                "0131447165",
                "0131449680",
                "0131450654",
                "0131450913",
                "0131453068",
                "0131453343",
                "013145353X",
                "0131454242",
                "0131454439",
                "0131454617",
                "0131454870",
                "0131457330",
                "0131457578",
                "0131463241",
                "0131464132",
                "0131465600",
                "0131465929",
                "0131469185",
                "0131469193",
                "0131469568",
                "0131469843",
                "0131470469",
                "0131470892",
                "0131471988",
                "0131475916",
                "0131477323",
                "0131478451",
                "0131479547",
                "0131479725",
                "0131481908",
                "0131483161",
                "0131483986",
                "0131485199",
                "0131485210",
                "0131486497",
                "0131487361",
                "0131489658",
                "0131491784",
                "0131494597",
                "0131494708",
                "0131494848",
                "0131495380",
                "0131495798",
                "013149726X",
                "0131497456",
                "0131497499",
                "0131497510",
                "0131497553",
                "0131499084",
                "0131499300",
                "0131499459",
                "0131534351",
                "0131538411",
                "0131542745",
                "0131547143",
                "0131548654",
                "0131554441",
                "013155445X",
                "0131602586",
                "0131672673",
                "0131676865",
                "0131678310",
                "0131679813",
                "0131697390",
                "013169944X",
                "0131699571",
                "0131708694",
                "0131730428",
                "0131733494",
                "0131786865",
                "0131816292",
                "0131837362",
                "013184069X",
                "0131851225",
                "0131854615",
                "0131854712",
                "0131856057",
                "0131856405",
                "0131856626",
                "0131857029",
                "013185755X",
                "0131857576",
                "0131857851",
                "0131860151",
                "0131860267",
                "0131862391",
                "0131866222",
                "0131867121",
                "0131867938",
                "0131868772",
                "0131869426",
                "0131870165",
                "0131870769",
                "0131873644",
                "0131873741",
                "0131878824",
                "0131888099",
                "0131891022",
                "0131892622",
                "013191345X",
                "0131918222",
                "0131918338",
                "0131919636",
                "0131922440",
                "0131925385",
                "0131930079",
                "0131930818",
                "0131931989",
                "0131931997",
                "0131933159",
                "0131950851",
                "0131963163",
                "0132184745",
                "0132186942",
                "0132187469",
                "0132192268",
                "0132203847",
                "0132277816",
                "0132431564",
                "0133214311",
                "0135265266",
                "0135763800",
                "013651068X",
                "013726142X",
                "0137549202",
                "0137903952",
                "013805326X",
                "0138147574",
                "0139078746",
                "0195073401",
                "0195108094",
                "0195110099",
                "0195116445",
                "0195136055",
                "0195142519",
                "0195158334",
                "0201128195",
                "0201146592",
                "0201180758",
                "0201543931",
                "0201763907",
                "0201770253",
                "0201771314",
                "0205376061",
                "0205426514",
                "0205439675",
                "020544444X",
                "0205449131",
                "0205449441",
                "0205457959",
                "0205459382",
                "0205473059",
                "0205477534",
                "0205478093",
                "0205483925",
                "0256136874",
                "0256247951",
                "0262032937",
                "0312406843",
                "0312406851",
                "0312407246",
                "0312412622",
                "0312419333",
                "0312434456",
                "0321149017",
                "0321159349",
                "0321162080",
                "0321166396",
                "0321185587",
                "032119800X",
                "0321227352",
                "0321227573",
                "0321228170",
                "0321236858",
                "0321236874",
                "0321267613",
                "0321270762",
                "0321278801",
                "0321278844",
                "0321280296",
                "032128030X",
                "0321287134",
                "0321293835",
                "0321295358",
                "0321305035",
                "0321305043",
                "0321322134",
                "0321330234",
                "0321330250",
                "0321357965",
                "0321369572",
                "0321389514",
                "0321409493",
                "0323018874",
                "0323024491",
                "0323025862",
                "0323025935",
                "0324007515",
                "0324066856",
                "0324171889",
                "0324174616",
                "0324188005",
                "0324200145",
                "0324201605",
                "0324202237",
                "032420485X",
                "0324204884",
                "0324205643",
                "0324221134",
                "032422155X",
                "0324223048",
                "0324223102",
                "0324224702",
                "0324225814",
                "0324226128",
                "0324226292",
                "0324233108",
                "0324233434",
                "0324235011",
                "032423662X",
                "0324236700",
                "0324236735",
                "0324258755",
                "0324259131",
                "0324259689",
                "0324259913",
                "0324260601",
                "0324260768",
                "0324261276",
                "0324270860",
                "0324288417",
                "032428845X",
                "0324288522",
                "0324288603",
                "032428893X",
                "0324289030",
                "0324289081",
                "0324289235",
                "0324289278",
                "0324289561",
                "0324289588",
                "0324289782",
                "032428991X",
                "032430160X",
                "0324302592",
                "0324303904",
                "0324314639",
                "0324316240",
                "0324316593",
                "0324316941",
                "0324317980",
                "0324319789",
                "0324319835",
                "0324320892",
                "0324321430",
                "0324323638",
                "0324376332",
                "0324400829",
                "0324405421",
                "0393924092",
                "0393924963",
                "0393925536",
                "0393927024",
                "0393970833",
                "0393975150",
                "0393977765",
                "0393978796",
                "0393979059",
                "0393979962",
                "0395977274",
                "0443100349",
                "0471000779",
                "0471120626",
                "0471134767",
                "0471144487",
                "0471152323",
                "0471153680",
                "0471198269",
                "0471202312",
                "047123009X",
                "0471232319",
                "0471272140",
                "0471274712",
                "0471321680",
                "0471348066",
                "0471393622",
                "0471410772",
                "0471413895",
                "047141526X",
                "0471417998",
                "0471420840",
                "0471433373",
                "0471433381",
                "047143339X",
                "0471445770",
                "0471445932",
                "0471450073",
                "0471465801",
                "0471470155",
                "0471487287",
                "047148735X",
                "0471488852",
                "0471563374",
                "0471655279",
                "0471656313",
                "0471661775",
                "0471661783",
                "0471662933",
                "0471663158",
                "0471675822",
                "0471681709",
                "0471684767",
                "0471689343",
                "0471692093",
                "0471692387",
                "0471694665",
                "0471705225",
                "0471715379",
                "0471730424",
                "0471730513",
                "0471736368",
                "0471736961",
                "0471737690",
                "0471749559",
                "0471755303",
                "0495005614",
                "0495011622",
                "0495012033",
                "0495015997",
                "0495031283",
                "0495093254",
                "0495187062",
                "0521370957",
                "0534209106",
                "0534229026",
                "0534359450",
                "0534378048",
                "0534380581",
                "0534387438",
                "0534389996",
                "0534392008",
                "053439339X",
                "0534399339",
                "0534405215",
                "0534408427",
                "0534408966",
                "0534417930",
                "0534418058",
                "0534418783",
                "0534491243",
                "053449143X",
                "0534492142",
                "0534536050",
                "0534553818",
                "0534554016",
                "0534558100",
                "0534559867",
                "0534585051",
                "0534589626",
                "0534589898",
                "0534590535",
                "0534600085",
                "053460725X",
                "0534607950",
                "0534608590",
                "0534618596",
                "0534621678",
                "0534948847",
                "0534950973",
                "0534997236",
                "053499766X",
                "0618400508",
                "0619215267",
                "061921743X",
                "0619255749",
                "0716715449",
                "0716743396",
                "0716743663",
                "0716752298",
                "0716752379",
                "0716757060",
                "0716758814",
                "0716764008",
                "0716764466",
                "0716791595",
                "0721601871",
                "0721602401",
                "0721690033",
                "0721697577",
                "0721697739",
                "0750661682",
                "076192261X",
                "0781736390",
                "0805306552",
                "0805330151",
                "080534635X",
                "0805346651",
                "0805346805",
                "0805347909",
                "0805348301",
                "0805359095",
                "0805366245",
                "0805368515",
                "080537146X",
                "0805371605",
                "0805372105",
                "0805372539",
                "0805372806",
                "0805373276",
                "080537678X",
                "0805385665",
                "080538684X",
                "0805391908",
                "0884271781",
                "0890420254",
                "1401860265",
                "1416000887",
                "1416025340",
                "1418835935",
                "1418835978",
                "1418836397",
                "1418843709",
                "1558606041",
                "155860832X",
                "1932531084",

        };

        for (String isbn : isbns) {
            IsbnServices.saveIsbn(db, isbn);
        }
    }

    @Override
    public SQLiteDatabase getWritableDatabase() {
        SQLiteDatabase db = super.getWritableDatabase();

        // Enable foreign keys. It must be executed every time we get the
        // database.
        db.execSQL("PRAGMA foreign_keys = ON;");
        return db;
    }

    @Override
    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {

        if (oldVersion < 2) {
            Version2.upgrade(db);
        }

        if (oldVersion < 3) {
            Version3.upgrade(db);
        }
    }
}
